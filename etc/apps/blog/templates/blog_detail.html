{% extends 'base.html' %}
{% load static %}
	<link rel="stylesheet" href="{% static 'css/style.css' %}" type="text/css" media="all" />

{% block content %}
	<div class="cover-container d-flex w-50 h-100 p-3 mx-auto flex-column">
		<h1 class="display-4 fst-italic text-center">{{ post.title }}</h1>
		<div class="row">
			<p align="center">
				<img src="{{ post.img.url }}" width="100%"/>
			</p>
			<div class="item">
				<div class="image left">
				</div>
				<div class="text left">
					<p>{{ post.description }}</p>
					<p>Author: {{ post.author }}</p>
				</div>
				{% if user.is_authenticated and post.author == user.username or user.superuser %}
				<a href="{% url 'edit_post' post.pk %}" class="btn btn-sm btn-outline-secondary">Edit</a>
				<form action="{% url 'delete_post' post.pk %}" method="POST" style="display:inline;">
					{% csrf_token %}
					<button type="submit" class="btn btn-sm btn-outline-secondary">Delete</button>
				</form>
				{% endif %}
			</div>
		</div>
		<div>
			<br>
			<p>Liked: {{ post.likes_set.all.count }}</p>
			{% if user.is_authenticated %}
			<a href="{% url 'add_likes' post.id %}">Like</a><br>
			<a href="{% url 'dislikes' post.id %}">Dislike</a>
			{% endif %}
		</div><br>
		<div class="row g-3">
			{% if user.is_authenticated %}
			<h3>Leave a comment</h3><br>
			<div class="col-12">
				<form action="{% url 'add_comments' post.id %}" method="post">
					{% csrf_token %}
					<div>
						<label for="text_comments" class="form-label">Your comment</label>
						<textarea name="text_comments" class="form-control" id="text_comments"></textarea>
					</div><br>
					<button class="w-100 btn btn-primary btn-lg" type="submit">Submit</button>
				</form>
			</div>
			{% else %}
			<div><br>
				<h3>Please Login to Leave a comment</h3>
				<a href="{% url 'login' %}" class="btn btn-outline-dark me-2">Login</a>
			</div>
			{% endif %}
		</div><br>
		<div class="row g-3">
			<h3>Comments</h3><br><br>
			<div class="col-12">
			{% for comment in post.comments_set.all %}
			<div class="view-comment">
				<h4>{{ comment.name }}</h4>
				<p>{{ comment.text_comments }}</p>
				<a href="#" class="reply">Reply</a>
				<form action="{% url 'add_comments' post.id %}" method="POST" class="reply-form" style="display:none;">
					{% csrf_token %}
					<input type="hidden" name="parent_id" value="{{ comment.id }}">
					<div>
						<label for="text_comments_{{ comment.id }}" class="form-label">Your reply</label>
						<textarea name="text_comments" class="form-control" id="text_comments_{{ comment.id }}"></textarea>
					</div><br>
					<button type="submit" class="w-100 btn btn-primary btn-lg">Submit</button>
				</form>
			</div>
			{% for reply in comment.replies.all %}
				<div class="view-comment" style="margin-left: 20px;">
					<h4>{{ reply.name }}</h4>
					<p>{{ reply.text_comments }}</p>
				</div>
			{% endfor %}
			{% endfor %}
			</div>
		</div>
	</div>

	<script>
		document.addEventListener('DOMContentLoaded', function () {
			document.querySelectorAll('.reply').forEach(function (element) {
				element.addEventListener('click', function (event) {
					event.preventDefault();
					var form = this.nextElementSibling;
					if (form.style.display === 'none') {
						form.style.display = 'block';
					} else {
						form.style.display = 'none';
					}
				});
			});
		});
	</script>
{% endblock %}
